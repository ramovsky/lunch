{% extends "base.jinja2" %}

{% block react %}
var restaurants = [
  {name: "Sisaket", distance: .6},
  {name: "Lyly", distance: .8},
];

var RestaurantsBox = React.createClass({
  getInitialState: function(){
    return {restaurants: []};
  },
  componentDidMount: function(){
    this.setState({restaurants: restaurants})
  },
  addRow: function(e){
    restaurants.push({name: '', distance: .5})
    this.setState({restaurants: restaurants})
  },
  onNameChange: function(name, row){
    restaurants[row]['name'] = name;
    this.setState({restaurants: restaurants});
  },
  onDistanceChange: function(distance, row){
    restaurants[row]['distance'] = distance;
    this.setState({restaurants: restaurants});
  },
  render: function(){
    return (
	<div className="restaurants">
	<h2>Restaurant name and distance</h2>
	<RestaurantList data={this.state.restaurants} onNameChange={this.onNameChange} onDistanceChange={this.onDistanceChange} />
	<a onClick={this.addRow}>Add</a>
	</div>
    );
  }
});

var RestaurantList = React.createClass({
  render: function(){
    var restaurant_node = this.props.data.map(function(restaurant, i){
      return (
	  <Restaurant name={restaurant.name} distance={restaurant.distance} row={i} onNameChange={this.props.onNameChange} onDistanceChange={this.props.onDistanceChange} />
      );
    }.bind(this));
    return (
      <div className="restaurant_list">
	{restaurant_node}
      </div>
    );
  }
});

var Restaurant = React.createClass({
  onNameChange: function(){
    // TODO: add validation
    this.props.onNameChange(this.refs.restaurantName.value, this.props.row);
  },
  onDistanceChange: function(){
    // TODO: add validation
    this.props.onDistanceChange(this.refs.restaurantDistance.value, this.props.row);
  },
  render: function(){
    return (
	<div className="restaurant">
	{this.props.row}
	<input className="restaurant_name" value={this.props.name} ref="restaurantName" onChange={this.onNameChange}/>
	<input className="restaurant_distance" value={this.props.distance} ref="restaurantDistance" onChange={this.onDistanceChange}/>
	</div>
    );
  }
});

ReactDOM.render(
    <RestaurantsBox />,
  document.getElementById('content')
);

window.data = restaurants

{% endblock %}
